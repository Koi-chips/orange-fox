#!/bin/bash

# Проверяем, передан ли аргумент (путь к директории)
if [ $# -ne 1 ]; then
    echo "Ошибка: Укажите путь к директории с логами."
    exit 1
fi

# Сохраняем путь к директории в переменную
DIR=$1

# Проверяем, существует ли директория
if [ ! -d "$DIR" ]; then
    echo "Ошибка: Директория $DIR не существует."
    exit 1
fi

# Формируем имя архива с текущей датой
ARCHIVE_NAME="logs-$(date +%Y-%m-%d).tar.gz"

# Находим файлы .log старше 7 дней и архивируем их
find "$DIR" -type f -name "*.log" -mtime +7 -exec tar -czf "$ARCHIVE_NAME" {} +

# Проверяем, успешно ли создан архив
if [ -f "$ARCHIVE_NAME" ]; then
    # Удаляем архивированные файлы
    find "$DIR" -type f -name "*.log" -mtime +7 -delete
    echo "Архивирование завершено. Создан архив: $ARCHIVE_NAME"
    echo "Удалены старые логи из директории: $DIR"
else
    echo "Ошибка: Не удалось создать архив."
    exit 1
fi
